# 事件循环-浏览器

## `事件循环`，是一种`js`的`执行模型`

+ 开始执行，创建一个`全局的执行上下文`，推入`执行栈`中，`执行栈`后进先出，执行完则`pop`出该上下文
+ 每遇到一个新的函数，会创建改函数的执行上下文，推入栈顶
+ 当遇到`异步函数`时，会将异步函数进行特殊处理
   + 有两个任务队列：`微任务`、``宏任务`
      + `微任务队列`，当执行栈清空时，首先取`微任务`中的任务，每次只取队首的一个`微任务`，压入栈顶，依次执行，直到微任务队列清空。
         + 若，`微任务队列`为空，则，访问`宏任务队列`
         + 若，当前`微任务`在执行过程中，产生了新的`微任务`，新的`微任务`，也会在这一期被消化掉
      + `宏任务队列`，当`微任务队列`被清空后，会取宏任务队列中队首的一个任务，压入栈顶并执行
         + 每次只取一个`宏任务`，当宏任务结束执行后，会去访问微任务队列，检查是否存在`微任务`待执行
         + 若，有`微任务`需要执行，根据`微任务`的执行规则，执行完毕后，才会又来取一个`宏任务`
         + 注：宏任务队列，即使有多个`宏任务`，每次也只取一个`宏任务`，执行结束后，会去访问`微任务队列`！！！不是一直把`宏任务`清空！！
   + `promise`，的回调函数（then()）会放到，`微任务队列`
      + `promise`中的`resolve`的函数，直接同步执行，不会放在`微任务`中
   + `setTimeout()`，`setInterval()`，`I/O`等`webApi`的`回调函数`，会放到，宏任务队列
+ 以上所述，如此循环，就是js的执行机制，也就是`事件循环`

